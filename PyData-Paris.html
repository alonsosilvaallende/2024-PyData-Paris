<!DOCTYPE html>
<html lang="en"><head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="PyData-Paris_files/libs/clipboard/clipboard.min.js"></script>
<script src="PyData-Paris_files/libs/quarto-html/tabby.min.js"></script>
<script src="PyData-Paris_files/libs/quarto-html/popper.min.js"></script>
<script src="PyData-Paris_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="PyData-Paris_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="PyData-Paris_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="PyData-Paris_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="PyData-Paris_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.528">

  <meta name="author" content="Alonso Silva (twitter/X: @alonsosilva)">
  <title>Enhancing RAG-based apps by constructing and leveraging knowledge graphs with open-weights LLMs</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="PyData-Paris_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="PyData-Paris_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="PyData-Paris_files/libs/revealjs/dist/theme/quarto.css">
  <link href="PyData-Paris_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="PyData-Paris_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="PyData-Paris_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="PyData-Paris_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Enhancing RAG-based apps by constructing and leveraging knowledge graphs with open-weights LLMs</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Alonso Silva (twitter/X: <span class="citation" data-cites="alonsosilva">@alonsosilva</span>) 
</div>
</div>
</div>

</section><section id="TOC">
<nav role="doc-toc"> 
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#/introduction" id="/toc-introduction">Introduction</a></li>
<li><a href="#/vector-only-retrieval" id="/toc-vector-only-retrieval">Vector-only retrieval</a></li>
<li><a href="#/graph-only-retrieval" id="/toc-graph-only-retrieval">Graph-only retrieval</a></li>
<li><a href="#/combining-graph-and-vector-retrieval" id="/toc-combining-graph-and-vector-retrieval">Combining graph and vector retrieval</a></li>
<li><a href="#/knowledge-graph-construction" id="/toc-knowledge-graph-construction">Knowledge graph construction</a></li>
<li><a href="#/conclusions" id="/toc-conclusions">Conclusions</a></li>
</ul>
</nav>
</section>
<section>
<section id="introduction" class="title-slide slide level1 center">
<h1>Introduction</h1>

</section>
<section id="data" class="slide level2">
<h2>Data</h2>
<div id="4bdb8335-e220-4428-bce7-92f72ff706df" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T06:59:46.455029Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T06:59:46.454661Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T06:59:52.516569Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T06:59:52.514931Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T06:59:46.454994Z&quot;}" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href=""></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb1-2"><a href=""></a><span class="im">import</span> string</span>
<span id="cb1-3"><a href=""></a></span>
<span id="cb1-4"><a href=""></a>df <span class="op">=</span> pl.read_csv(</span>
<span id="cb1-5"><a href=""></a>    <span class="st">"https://drive.google.com/uc?export=download&amp;id=1uD3h7xYxr9EoZ0Ggoh99JtQXa3AxtxyU"</span></span>
<span id="cb1-6"><a href=""></a>)</span>
<span id="cb1-7"><a href=""></a>df <span class="op">=</span> df.with_columns(</span>
<span id="cb1-8"><a href=""></a>    pl.Series(<span class="st">"Album"</span>, [string.capwords(album) <span class="cf">for</span> album <span class="kw">in</span> df[<span class="st">"Album"</span>]])</span>
<span id="cb1-9"><a href=""></a>)</span>
<span id="cb1-10"><a href=""></a>df <span class="op">=</span> df.with_columns(</span>
<span id="cb1-11"><a href=""></a>    pl.Series(<span class="st">"Song"</span>, [string.capwords(song) <span class="cf">for</span> song <span class="kw">in</span> df[<span class="st">"Song"</span>]])</span>
<span id="cb1-12"><a href=""></a>)</span>
<span id="cb1-13"><a href=""></a>df <span class="op">=</span> df.with_columns(pl.col(<span class="st">"Lyrics"</span>).fill_null(<span class="st">"None"</span>))</span>
<span id="cb1-14"><a href=""></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 4)</small>
<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Song</th>
<th data-quarto-table-cell-role="th">Lyrics</th>
<th data-quarto-table-cell-role="th">Album</th>
<th data-quarto-table-cell-role="th">Artist</th>
</tr>
<tr class="odd">
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Don't Tread On Me"</td>
<td>"Liberty or death what we so pr…</td>
<td>"The Black Album"</td>
<td>"Metallica"</td>
</tr>
<tr class="even">
<td>"Nothing Else Matters"</td>
<td>"So close no matter how far cou…</td>
<td>"The Black Album"</td>
<td>"Metallica"</td>
</tr>
<tr class="odd">
<td>"Through The Never"</td>
<td>"All that is was and will be un…</td>
<td>"The Black Album"</td>
<td>"Metallica"</td>
</tr>
<tr class="even">
<td>"My Friend Of Misery"</td>
<td>"You just stood there screaming…</td>
<td>"The Black Album"</td>
<td>"Metallica"</td>
</tr>
<tr class="odd">
<td>"Wherever I May Roam"</td>
<td>"...and the road becomes my bri…</td>
<td>"The Black Album"</td>
<td>"Metallica"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="potential-kind-of-queries" class="slide level2">
<h2>Potential kind of queries</h2>
<div id="acfa768a-b9cd-4ac8-8d4e-c033c3772f0e" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T06:59:52.527757Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T06:59:52.527256Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T06:59:52.549916Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T06:59:52.548718Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T06:59:52.527708Z&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href=""></a>queries <span class="op">=</span> [</span>
<span id="cb2-2"><a href=""></a>    <span class="st">"Which song is about a boy who is having nightmares?"</span>,</span>
<span id="cb2-3"><a href=""></a>    <span class="st">"Which song is about a guy who is so badly wounded in war so he no longer has any senses?"</span>,</span>
<span id="cb2-4"><a href=""></a>    <span class="st">"How many songs does the reload album have?"</span>,</span>
<span id="cb2-5"><a href=""></a>    <span class="st">"Which songs does the black album have?"</span></span>
<span id="cb2-6"><a href=""></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section>
<section>
<section id="vector-only-retrieval" class="title-slide slide level1 center">
<h1>Vector-only retrieval</h1>

</section>
<section id="vector-only-retrieval-1" class="slide level2">
<h2>Vector-only retrieval</h2>
<div id="221e6fc8-dc12-4dc9-a52c-011b605b4819" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T06:59:52.573021Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T06:59:52.572527Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T06:59:52.590665Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T06:59:52.589523Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T06:59:52.572975Z&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href=""></a>df <span class="op">=</span> df.with_columns(</span>
<span id="cb3-2"><a href=""></a>    text<span class="op">=</span>pl.lit(<span class="st">"# "</span>)</span>
<span id="cb3-3"><a href=""></a>    <span class="op">+</span> pl.col(<span class="st">"Album"</span>)</span>
<span id="cb3-4"><a href=""></a>    <span class="op">+</span> pl.lit(<span class="st">": "</span>)</span>
<span id="cb3-5"><a href=""></a>    <span class="op">+</span> pl.col(<span class="st">"Song"</span>)</span>
<span id="cb3-6"><a href=""></a>    <span class="op">+</span> pl.lit(<span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>)</span>
<span id="cb3-7"><a href=""></a>    <span class="op">+</span> pl.col(<span class="st">"Lyrics"</span>)</span>
<span id="cb3-8"><a href=""></a>)</span>
<span id="cb3-9"><a href=""></a></span>
<span id="cb3-10"><a href=""></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 5)</small>
<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Song</th>
<th data-quarto-table-cell-role="th">Lyrics</th>
<th data-quarto-table-cell-role="th">Album</th>
<th data-quarto-table-cell-role="th">Artist</th>
<th data-quarto-table-cell-role="th">text</th>
</tr>
<tr class="odd">
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Don't Tread On Me"</td>
<td>"Liberty or death what we so pr…</td>
<td>"The Black Album"</td>
<td>"Metallica"</td>
<td>"# The Black Album: Don't Tread…</td>
</tr>
<tr class="even">
<td>"Nothing Else Matters"</td>
<td>"So close no matter how far cou…</td>
<td>"The Black Album"</td>
<td>"Metallica"</td>
<td>"# The Black Album: Nothing Els…</td>
</tr>
<tr class="odd">
<td>"Through The Never"</td>
<td>"All that is was and will be un…</td>
<td>"The Black Album"</td>
<td>"Metallica"</td>
<td>"# The Black Album: Through The…</td>
</tr>
<tr class="even">
<td>"My Friend Of Misery"</td>
<td>"You just stood there screaming…</td>
<td>"The Black Album"</td>
<td>"Metallica"</td>
<td>"# The Black Album: My Friend O…</td>
</tr>
<tr class="odd">
<td>"Wherever I May Roam"</td>
<td>"...and the road becomes my bri…</td>
<td>"The Black Album"</td>
<td>"Metallica"</td>
<td>"# The Black Album: Wherever I …</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="vector-only-retrieval-2" class="slide level2">
<h2>Vector-only retrieval</h2>
<div id="bfb78d4e-952c-4451-8f1c-7715e68e28d2" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T06:59:52.592783Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T06:59:52.592307Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T06:59:52.603746Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T06:59:52.602258Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T06:59:52.592737Z&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href=""></a><span class="bu">print</span>(df.select(<span class="st">"text"</span>)[<span class="dv">1</span>].item()[:<span class="dv">300</span>])</span>
<span id="cb4-2"><a href=""></a><span class="bu">print</span>(<span class="st">"..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># The Black Album: Nothing Else Matters

So close no matter how far
couldn't be much more from the heart
forever trusting who we are
and nothing else matters
never opened myself this way
life is ours
we live it our way
all these words I don't just say
and nothing else matters
trust I seek and I find
...</code></pre>
</div>
</div>
</section>
<section id="vector-only-retrieval-3" class="slide level2">
<h2>Vector-only retrieval</h2>
<div id="879c6d5e-87d5-485c-86c1-026206ac275f" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T06:59:52.606333Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T06:59:52.605382Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T06:59:53.159067Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T06:59:53.157792Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T06:59:52.606281Z&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href=""></a><span class="im">import</span> shutil</span>
<span id="cb6-2"><a href=""></a><span class="im">import</span> lancedb</span>
<span id="cb6-3"><a href=""></a></span>
<span id="cb6-4"><a href=""></a>shutil.rmtree(<span class="st">"test_lancedb"</span>, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-5"><a href=""></a>db <span class="op">=</span> lancedb.<span class="ex">connect</span>(<span class="st">"test_lancedb"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="vector-only-retrieval-4" class="slide level2">
<h2>Vector-only retrieval</h2>
<div id="db1bb40f-fe45-458a-a18b-74ed3e4f8e49" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T06:59:53.160014Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T06:59:53.159788Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T06:59:53.163717Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T06:59:53.162985Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T06:59:53.159996Z&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href=""></a><span class="im">from</span> lancedb.embeddings <span class="im">import</span> get_registry</span>
<span id="cb7-2"><a href=""></a></span>
<span id="cb7-3"><a href=""></a>embeddings <span class="op">=</span> (</span>
<span id="cb7-4"><a href=""></a>    get_registry()</span>
<span id="cb7-5"><a href=""></a>    .get(<span class="st">"sentence-transformers"</span>)</span>
<span id="cb7-6"><a href=""></a>    .create(name<span class="op">=</span><span class="st">"TaylorAI/gte-tiny"</span>, device<span class="op">=</span><span class="st">"cuda"</span>)</span>
<span id="cb7-7"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="vector-only-retrieval-5" class="slide level2">
<h2>Vector-only retrieval</h2>
<div id="784ad2ce-d0b4-4154-9b21-25873d7fbb31" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T06:59:53.165833Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T06:59:53.165078Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T06:59:59.920995Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T06:59:59.919715Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T06:59:53.165774Z&quot;}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href=""></a><span class="im">from</span> lancedb.pydantic <span class="im">import</span> LanceModel, Vector</span>
<span id="cb8-2"><a href=""></a></span>
<span id="cb8-3"><a href=""></a><span class="kw">class</span> Songs(LanceModel):</span>
<span id="cb8-4"><a href=""></a>    Song: <span class="bu">str</span></span>
<span id="cb8-5"><a href=""></a>    Lyrics: <span class="bu">str</span></span>
<span id="cb8-6"><a href=""></a>    Album: <span class="bu">str</span></span>
<span id="cb8-7"><a href=""></a>    Artist: <span class="bu">str</span></span>
<span id="cb8-8"><a href=""></a>    text: <span class="bu">str</span> <span class="op">=</span> embeddings.SourceField()</span>
<span id="cb8-9"><a href=""></a>    vector: Vector(embeddings.ndims()) <span class="op">=</span> embeddings.VectorField()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="vector-only-retrieval-6" class="slide level2">
<h2>Vector-only retrieval</h2>
<div id="65f3f267-7290-4f2b-a493-f901e371e062" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T06:59:59.922053Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T06:59:59.921731Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:00:00.252792Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:00:00.251609Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T06:59:59.922034Z&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href=""></a>table <span class="op">=</span> db.create_table(<span class="st">"Songs"</span>, schema<span class="op">=</span>Songs)</span>
<span id="cb9-2"><a href=""></a>table.add(data<span class="op">=</span>df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="vector-only-retrieval-7" class="slide level2">
<h2>Vector-only retrieval</h2>
<div id="22439836-efdf-4614-b8c9-9ada9faeaa4c" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:00:00.260782Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:00:00.260481Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:00:00.314710Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:00:00.313387Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:00:00.260752Z&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href=""></a>query <span class="op">=</span> <span class="st">"Which song is about a boy who is having nightmares?"</span></span>
<span id="cb10-2"><a href=""></a>results <span class="op">=</span> table.search(query).limit(<span class="dv">10</span>).to_polars()</span>
<span id="cb10-3"><a href=""></a>results[<span class="st">"Song"</span>].to_list()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>['Enter Sandman',
 'The Thing That Should Not Be',
 'Hero Of The Day',
 'The Thing That Should Not Be',
 'Hero Of The Day',
 'Invisible Kid',
 'Enter Sandman',
 'Sad But True',
 'My Friend Of Misery',
 'One']</code></pre>
</div>
</div>
</section>
<section id="vector-only-retrieval-8" class="slide level2">
<h2>Vector-only retrieval</h2>
<div id="29d9ec00-689e-4c5b-b43b-3f24523e2285" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:00:00.315864Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:00:00.315612Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:00:00.338066Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:00:00.336740Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:00:00.315841Z&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href=""></a>query <span class="op">=</span> <span class="st">"Which song is about a guy who is so badly wounded in war so he no longer has any senses?"</span></span>
<span id="cb12-2"><a href=""></a>results <span class="op">=</span> table.search(query).limit(<span class="dv">10</span>).to_polars()</span>
<span id="cb12-3"><a href=""></a>results[<span class="st">"Song"</span>].to_list()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>['Phantom Lord',
 'One',
 'No Remorse',
 'One',
 'My Friend Of Misery',
 "Low Man's Lyric",
 'The Unforgiven',
 'Sad But True',
 "Don't Tread On Me",
 '2x4']</code></pre>
</div>
</div>
</section>
<section id="vector-only-retrieval-9" class="slide level2">
<h2>Vector-only retrieval</h2>
<p><a href="https://alonsosilva-song-finder.hf.space">https://alonsosilva-song-finder.hf.space</a></p>
<div id="2ebd3acb-cd8e-499a-9ccf-1706eb4e9e7f" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:00:00.340375Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:00:00.339673Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:00:00.347586Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:00:00.346515Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:00:00.340322Z&quot;}" data-execution_count="15">
<div class="cell-output cell-output-display" data-execution_count="15">

        <iframe width="850" height="450" src="https://alonsosilva-song-finder.hf.space" frameborder="0" allowfullscreen=""></iframe>
        
</div>
</div>
</section>
<section id="retrieval-augmented-generation-rag" class="slide level2">
<h2>Retrieval Augmented Generation (RAG)</h2>
<div id="dca44d07-01dd-4e95-bfc6-3de7f3594929" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:00:00.349526Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:00:00.349057Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:00:02.755246Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:00:02.754670Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:00:00.349480Z&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href=""></a><span class="im">import</span> llama_cpp</span>
<span id="cb14-2"><a href=""></a></span>
<span id="cb14-3"><a href=""></a>llm <span class="op">=</span> llama_cpp.Llama(</span>
<span id="cb14-4"><a href=""></a>    <span class="st">"/big_storage/llms/models/Hermes-3-Llama-3.1-8B.Q6_K.gguf"</span>,</span>
<span id="cb14-5"><a href=""></a>    tokenizer<span class="op">=</span>llama_cpp.llama_tokenizer.LlamaHFTokenizer.from_pretrained(</span>
<span id="cb14-6"><a href=""></a>        <span class="st">"NousResearch/Hermes-3-Llama-3.1-8B"</span></span>
<span id="cb14-7"><a href=""></a>    ),</span>
<span id="cb14-8"><a href=""></a>    n_gpu_layers<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="cb14-9"><a href=""></a>    flash_attn<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb14-10"><a href=""></a>    n_ctx<span class="op">=</span><span class="dv">8192</span>,</span>
<span id="cb14-11"><a href=""></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb14-12"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="retrieval-augmented-generation-rag-1" class="slide level2">
<h2>Retrieval Augmented Generation (RAG)</h2>
<div id="ff3f76e0-691a-49a0-bcb2-88e529a9feb5" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:00:02.756290Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:00:02.755955Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:00:02.770970Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:00:02.769993Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:00:02.756270Z&quot;}" data-scrolled="true" data-execution_count="17">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href=""></a><span class="kw">def</span> get_relevant_texts(query):</span>
<span id="cb15-2"><a href=""></a>    results <span class="op">=</span> (</span>
<span id="cb15-3"><a href=""></a>        table.search(query)</span>
<span id="cb15-4"><a href=""></a>             .limit(<span class="dv">5</span>)</span>
<span id="cb15-5"><a href=""></a>             .to_polars()</span>
<span id="cb15-6"><a href=""></a>    )</span>
<span id="cb15-7"><a href=""></a>    <span class="cf">return</span> <span class="st">" "</span>.join([results[<span class="st">"text"</span>][i] <span class="op">+</span> <span class="st">"</span><span class="ch">\n\n</span><span class="st">---</span><span class="ch">\n\n</span><span class="st">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)])</span>
<span id="cb15-8"><a href=""></a></span>
<span id="cb15-9"><a href=""></a><span class="bu">print</span>(get_relevant_texts(query))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Kill 'em All: Phantom Lord

Sound is ripping through your ears
The deafening sound of metal nears
Your bodies waiting for his whips
The taste of leather on your lips
Hear the cry of war
Louder than before
With his sword in hand
To control the land
Crushing metal strikes
On this frightening night
Fall onto your knees
For the phantom lord
Victims falling under chains
You hear them crying dying pains
The fist of terrors breaking through
Now there's nothing you can do
Hear the cry of war
Louder than before
With his sword in hand
To control the land
Crushing metal strikes
On this frightening night
Fall onto your knees
For the phantom lord
The leather armies have prevailed
The phantom lord has never failed
Smoke is lifting from the ground
The rising volume metal sound
Hear the cry of war
Louder than before
With his sword in hand
To control the land
Crushing metal strikes
On this frightening night
Fall onto your knees
For the phantom lord
Fall to your knees
And bow to the phantom lord

---

 # And Justice For All..: One

I Can't Remember Anything
Can't Tell If this Is True or Dream
Deep down Inside I Feel to Scream
this Terrible Silence Stops Me
Now That the War Is Through with Me
I'm Waking up I Can Not See
That There Is Not Much Left of Me
Nothing Is Real but Pain Now
Hold My Breath as I Wish for Death
Oh Please God,wake Me
Back in the Womb its Much Too Real
in Pumps Life That I must Feel
but Can't Look Forward to Reveal
Look to the Time When I'll Live
Fed Through the Tube That Sticks in Me
Just like a Wartime Novelty
Tied to Machines That Make Me Be
Cut this Life off from Me
Hold My Breath as I Wish for Death
Oh Please God,wake Me
Now the World Is Gone I'm Just One
Oh God,help Me Hold My Breath as I Wish for Death
Oh Please God Help Me
Darkness
Imprisoning Me
All That I See
Absolute Horror
I Cannot Live
I Cannot Die
Trapped in Myself
Body My Holding Cell
Landmine
Has Taken My Sight
Taken My Speech
Taken My Hearing
Taken My Arms
Taken My Legs
Taken My Soul
Left Me with Life in Hell

---

 # Kill 'em All: No Remorse

No mercy for what we are doing
No thought to even what we have done
We don't need to feel the sorrow
No remorse for the helpless one
War without end
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
Blood feeds the war machine
As it eats its way across the land
We don't need to feel the sorrow
No remorse is the one command
War without end
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
Only the strong survive
No one to save the weaker race
We are ready to kill all comers
Like a loaded gun right at your face
War without end
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
Attack
Bullets are flying
People are dying
With madness surrounding all hell's breaking loose
Soldiers are hounding
Bodies are mounting
Cannons are shouting to take their abuse
With war machines going
Blood starts to flowing
No mercy given to anyone hear
The furious fighting
Swords are like lighting
It all becomes frightening to you
Know death is near
No remorse

---

 # S&amp;m: One

I can't remember anything
Can't tell if this is true or dream
Deep down
inside I feel to scream
This terrible silence stops me
Now that the war is through with me
I'm waking up, I cannot see
That
there's not much left of me
Nothing is real but pain now
Hold my breath as I wish for death
Oh please God, wake me
Back in the womb it's much to real
In pumps life that I must feel
But
can't look forward to reveal
Look to the time when I lived
Fed through the tube that sticks in me
Just like a wartime novelty
Tied
to machines that make me be
Cut this shit out from me
Hold my breath as I wish for death
Oh please God, wake me
Please God
wake me!
Now the world is gone I'm just one
Oh God, help me
Hold my breath as I
wish for death
Oh please God, help me, help me!!
Darkness
Imprisoning me
All that I see
Absolute horror
I cannot
live
I cannot die
Trapped in myself
Body my holding cell
Landmine
Has taken my sight
Taken my speech
Taken my
hearing
Taken my arms
Taken my legs
Taken my soul
Left me with life
in hell 
no, NO, NO NO NO NO NO!!!

---

 # The Black Album: My Friend Of Misery

You just stood there screaming
fearing no one was listening to you
they say the empty can rattles the most
the sound of your voice must soothe you
hearing only what you want to hear
and knowing only what you've heard
you you're smothered in tragedy
you're out to save the world
misery
you insist that the weight of the world
should be on your shoulders
misery
there's much more to life than what you see
my friend of misery
you still stood there screaming
no one caring about these words you tell
my friend before your voice is gone
one man's fun is another's hell
these times are sent to try men's souls
but something's wrong with all you see
you you'll take it on all yourself
remember
misery loves company
misery
you insist that the weight of the world
should be on your shoulders
misery
there's much more to life than what you see
my friend of misery
you just stood there creaming
my friend of misery

---

</code></pre>
</div>
</div>
</section>
<section id="retrieval-augmented-generation-rag-2" class="slide level2">
<h2>Retrieval Augmented Generation (RAG)</h2>
<div id="548bbd82-4d11-475f-b3f9-afee31a50e13" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:00:02.773107Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:00:02.772326Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:00:02.804947Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:00:02.803741Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:00:02.773058Z&quot;}" data-scrolled="true" data-execution_count="18">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href=""></a><span class="kw">def</span> generate_prompt(query):</span>
<span id="cb17-2"><a href=""></a>    <span class="cf">return</span> (</span>
<span id="cb17-3"><a href=""></a>        <span class="st">"Answer the question based only on the following context:</span><span class="ch">\n\n</span><span class="st">"</span></span>
<span id="cb17-4"><a href=""></a>        <span class="op">+</span> get_relevant_texts(query)</span>
<span id="cb17-5"><a href=""></a>        <span class="op">+</span> <span class="st">"</span><span class="ch">\n\n</span><span class="st">Question: "</span></span>
<span id="cb17-6"><a href=""></a>        <span class="op">+</span> query</span>
<span id="cb17-7"><a href=""></a>    )</span>
<span id="cb17-8"><a href=""></a></span>
<span id="cb17-9"><a href=""></a><span class="bu">print</span>(generate_prompt(query))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Answer the question based only on the following context:

# Kill 'em All: Phantom Lord

Sound is ripping through your ears
The deafening sound of metal nears
Your bodies waiting for his whips
The taste of leather on your lips
Hear the cry of war
Louder than before
With his sword in hand
To control the land
Crushing metal strikes
On this frightening night
Fall onto your knees
For the phantom lord
Victims falling under chains
You hear them crying dying pains
The fist of terrors breaking through
Now there's nothing you can do
Hear the cry of war
Louder than before
With his sword in hand
To control the land
Crushing metal strikes
On this frightening night
Fall onto your knees
For the phantom lord
The leather armies have prevailed
The phantom lord has never failed
Smoke is lifting from the ground
The rising volume metal sound
Hear the cry of war
Louder than before
With his sword in hand
To control the land
Crushing metal strikes
On this frightening night
Fall onto your knees
For the phantom lord
Fall to your knees
And bow to the phantom lord

---

 # And Justice For All..: One

I Can't Remember Anything
Can't Tell If this Is True or Dream
Deep down Inside I Feel to Scream
this Terrible Silence Stops Me
Now That the War Is Through with Me
I'm Waking up I Can Not See
That There Is Not Much Left of Me
Nothing Is Real but Pain Now
Hold My Breath as I Wish for Death
Oh Please God,wake Me
Back in the Womb its Much Too Real
in Pumps Life That I must Feel
but Can't Look Forward to Reveal
Look to the Time When I'll Live
Fed Through the Tube That Sticks in Me
Just like a Wartime Novelty
Tied to Machines That Make Me Be
Cut this Life off from Me
Hold My Breath as I Wish for Death
Oh Please God,wake Me
Now the World Is Gone I'm Just One
Oh God,help Me Hold My Breath as I Wish for Death
Oh Please God Help Me
Darkness
Imprisoning Me
All That I See
Absolute Horror
I Cannot Live
I Cannot Die
Trapped in Myself
Body My Holding Cell
Landmine
Has Taken My Sight
Taken My Speech
Taken My Hearing
Taken My Arms
Taken My Legs
Taken My Soul
Left Me with Life in Hell

---

 # Kill 'em All: No Remorse

No mercy for what we are doing
No thought to even what we have done
We don't need to feel the sorrow
No remorse for the helpless one
War without end
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
Blood feeds the war machine
As it eats its way across the land
We don't need to feel the sorrow
No remorse is the one command
War without end
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
Only the strong survive
No one to save the weaker race
We are ready to kill all comers
Like a loaded gun right at your face
War without end
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
Attack
Bullets are flying
People are dying
With madness surrounding all hell's breaking loose
Soldiers are hounding
Bodies are mounting
Cannons are shouting to take their abuse
With war machines going
Blood starts to flowing
No mercy given to anyone hear
The furious fighting
Swords are like lighting
It all becomes frightening to you
Know death is near
No remorse

---

 # S&amp;m: One

I can't remember anything
Can't tell if this is true or dream
Deep down
inside I feel to scream
This terrible silence stops me
Now that the war is through with me
I'm waking up, I cannot see
That
there's not much left of me
Nothing is real but pain now
Hold my breath as I wish for death
Oh please God, wake me
Back in the womb it's much to real
In pumps life that I must feel
But
can't look forward to reveal
Look to the time when I lived
Fed through the tube that sticks in me
Just like a wartime novelty
Tied
to machines that make me be
Cut this shit out from me
Hold my breath as I wish for death
Oh please God, wake me
Please God
wake me!
Now the world is gone I'm just one
Oh God, help me
Hold my breath as I
wish for death
Oh please God, help me, help me!!
Darkness
Imprisoning me
All that I see
Absolute horror
I cannot
live
I cannot die
Trapped in myself
Body my holding cell
Landmine
Has taken my sight
Taken my speech
Taken my
hearing
Taken my arms
Taken my legs
Taken my soul
Left me with life
in hell 
no, NO, NO NO NO NO NO!!!

---

 # The Black Album: My Friend Of Misery

You just stood there screaming
fearing no one was listening to you
they say the empty can rattles the most
the sound of your voice must soothe you
hearing only what you want to hear
and knowing only what you've heard
you you're smothered in tragedy
you're out to save the world
misery
you insist that the weight of the world
should be on your shoulders
misery
there's much more to life than what you see
my friend of misery
you still stood there screaming
no one caring about these words you tell
my friend before your voice is gone
one man's fun is another's hell
these times are sent to try men's souls
but something's wrong with all you see
you you'll take it on all yourself
remember
misery loves company
misery
you insist that the weight of the world
should be on your shoulders
misery
there's much more to life than what you see
my friend of misery
you just stood there creaming
my friend of misery

---



Question: Which song is about a guy who is so badly wounded in war so he no longer has any senses?</code></pre>
</div>
</div>
</section>
<section id="retrieval-augmented-generation-rag-3" class="slide level2">
<h2>Retrieval Augmented Generation (RAG)</h2>
<div id="4eba26ab-13a7-493c-b3a2-6928faf5431b" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:00:02.807065Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:00:02.806472Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:00:02.813971Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:00:02.812705Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:00:02.807017Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href=""></a><span class="kw">def</span> generate_response(query):</span>
<span id="cb19-2"><a href=""></a>    prompt <span class="op">=</span> generate_prompt(query)</span>
<span id="cb19-3"><a href=""></a>    response <span class="op">=</span> llm.create_chat_completion(</span>
<span id="cb19-4"><a href=""></a>        messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt}], </span>
<span id="cb19-5"><a href=""></a>        temperature<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb19-6"><a href=""></a>        seed<span class="op">=</span><span class="dv">42</span></span>
<span id="cb19-7"><a href=""></a>    )</span>
<span id="cb19-8"><a href=""></a>    <span class="cf">return</span> response[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">"message"</span>][<span class="st">"content"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="retrieval-augmented-generation-rag-4" class="slide level2">
<h2>Retrieval Augmented Generation (RAG)</h2>
<div id="a86366f6-741a-4542-9de3-1f4d43065ad3" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:00:02.816197Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:00:02.815610Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:00:05.359370Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:00:05.358576Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:00:02.816148Z&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href=""></a>query <span class="op">=</span> <span class="st">"Which song is about a guy who is so badly wounded in war so he no longer has any senses?"</span></span>
<span id="cb20-2"><a href=""></a><span class="bu">print</span>(generate_response(query))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The song that is about a guy who is so badly wounded in war that he no longer has any senses is "And Justice For All..: One". The lyrics mention that the person has lost their sight, speech, hearing, arms, legs, and soul, and is left with life in hell.</code></pre>
</div>
</div>
</section>
<section id="retrieval-augmented-generation-rag-5" class="slide level2">
<h2>Retrieval Augmented Generation (RAG)</h2>
<div id="b9e95cce-6b01-4a16-8131-b494b6b5fff0" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:00:05.361727Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:00:05.361472Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:00:09.843450Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:00:09.842030Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:00:05.361710Z&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href=""></a>query <span class="op">=</span> <span class="st">"Which song is about a boy who is having nightmares?"</span></span>
<span id="cb22-2"><a href=""></a><span class="bu">print</span>(generate_response(query))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The song that is about a boy who is having nightmares is "The Black Album: Enter Sandman". The lyrics mention "Say your prayers little one", "tuck you in warm within", "keep you free from sin till the sandman he comes", "sleep with one eye open gripping your pillow tight", "dreams of war dreams of liars dreams of dragon's fire and of things that will bite", and "now I lay me down to sleep pray the lord my soul to keep". These lines indicate that the song is about a child having nightmares and fearing the dark.</code></pre>
</div>
</div>
</section>
<section id="retrieval-augmented-generation-rag-6" class="slide level2">
<h2>Retrieval Augmented Generation (RAG)</h2>
<p><a href="https://alonsosilva-song-finder-bot.hf.space">https://alonsosilva-song-finder-bot.hf.space</a></p>
<div id="86e8e0b7-22ad-438d-96f1-03cfc2ac9561" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:00:09.845729Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:00:09.845097Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:00:09.853220Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:00:09.852307Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:00:09.845677Z&quot;}" data-execution_count="22">
<div class="cell-output cell-output-display" data-execution_count="22">

        <iframe width="850" height="450" src="https://alonsosilva-song-finder-bot.hf.space" frameborder="0" allowfullscreen=""></iframe>
        
</div>
</div>
</section>
<section id="retrieval-augmented-generation-rag-7" class="slide level2">
<h2>Retrieval Augmented Generation (RAG)</h2>
<div id="0dab57df-5969-4187-918c-2625c0a1fff2" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:00:09.855320Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:00:09.854594Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:00:12.064603Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:00:12.064056Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:00:09.855268Z&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href=""></a>query <span class="op">=</span> <span class="st">"How many songs does the black album have?"</span></span>
<span id="cb24-2"><a href=""></a><span class="bu">print</span>(generate_response(query))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Based on the context provided, the Black Album has 5 songs:

1. My Friend Of Misery
2. Nothing Else Matters
3. Don't Tread On Me
4. Sad But True
5. Holier Than Thou</code></pre>
</div>
</div>
</section>
<section id="retrieval-augmented-generation-rag-8" class="slide level2">
<h2>Retrieval Augmented Generation (RAG)</h2>
<div id="d15afb6a-edf4-42f3-bf3c-b8b6d40c7fb2" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:00:12.065506Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:00:12.065317Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:00:12.069971Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:00:12.069551Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:00:12.065489Z&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href=""></a>df.<span class="bu">filter</span>(pl.col(<span class="st">"Album"</span>) <span class="op">==</span> <span class="st">"The Black Album"</span>)[<span class="st">"Song"</span>].to_list()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>["Don't Tread On Me",
 'Nothing Else Matters',
 'Through The Never',
 'My Friend Of Misery',
 'Wherever I May Roam',
 'The Unforgiven',
 'The Struggle Within',
 'Of Wolf And Man',
 'The God That Failed',
 'Enter Sandman',
 'Sad But True',
 'Holier Than Thou']</code></pre>
</div>
</div>
</section></section>
<section>
<section id="graph-only-retrieval" class="title-slide slide level1 center">
<h1>Graph-only retrieval</h1>

</section>
<section id="graph-only-retrieval-1" class="slide level2">
<h2>Graph-only retrieval</h2>
<div id="69a93028-05e3-41da-86cc-236243c1eeea" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:00:29.471926Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:00:29.471224Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:00:29.624677Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:00:29.623795Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:00:29.471866Z&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href=""></a><span class="co"># Initialize graph database</span></span>
<span id="cb28-2"><a href=""></a><span class="im">import</span> shutil</span>
<span id="cb28-3"><a href=""></a><span class="im">import</span> kuzu</span>
<span id="cb28-4"><a href=""></a></span>
<span id="cb28-5"><a href=""></a>shutil.rmtree(<span class="st">"test_kuzudb"</span>, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-6"><a href=""></a>db <span class="op">=</span> kuzu.Database(<span class="st">"test_kuzudb"</span>)</span>
<span id="cb28-7"><a href=""></a>conn <span class="op">=</span> kuzu.Connection(db)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="graph-only-retrieval-2" class="slide level2">
<h2>Graph-only retrieval</h2>
<div id="cadab962-0b2f-4f5c-a004-d8c312ea7480" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:00:34.319490Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:00:34.318861Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:00:34.414884Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:00:34.413362Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:00:34.319435Z&quot;}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href=""></a><span class="co"># Create schema</span></span>
<span id="cb29-2"><a href=""></a>conn.execute(<span class="st">"CREATE NODE TABLE ARTIST(name STRING, PRIMARY KEY (name))"</span>)</span>
<span id="cb29-3"><a href=""></a>conn.execute(<span class="st">"CREATE NODE TABLE ALBUM(name STRING, PRIMARY KEY (name))"</span>)</span>
<span id="cb29-4"><a href=""></a>conn.execute(<span class="st">"CREATE NODE TABLE SONG(ID SERIAL, name STRING, lyrics STRING, PRIMARY KEY(ID))"</span>)</span>
<span id="cb29-5"><a href=""></a>conn.execute(<span class="st">"CREATE REL TABLE IN_ALBUM(FROM SONG TO ALBUM)"</span>)</span>
<span id="cb29-6"><a href=""></a>conn.execute(<span class="st">"CREATE REL TABLE FROM_ARTIST(FROM ALBUM TO ARTIST)"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="graph-only-retrieval-3" class="slide level2">
<h2>Graph-only retrieval</h2>
<div id="25b00787-5426-4573-838a-98dc1c5079e2" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:00:36.258528Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:00:36.257942Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:00:37.802105Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:00:37.800410Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:00:36.258474Z&quot;}" data-scrolled="true" data-execution_count="27">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href=""></a><span class="co"># Insert nodes</span></span>
<span id="cb30-2"><a href=""></a><span class="cf">for</span> artist <span class="kw">in</span> df[<span class="st">"Artist"</span>].unique():</span>
<span id="cb30-3"><a href=""></a>    conn.execute(<span class="ss">f"CREATE (artist:ARTIST </span><span class="ch">{{</span><span class="ss">name: '</span><span class="sc">{</span>artist<span class="sc">}</span><span class="ss">'</span><span class="ch">}}</span><span class="ss">)"</span>)</span>
<span id="cb30-4"><a href=""></a></span>
<span id="cb30-5"><a href=""></a><span class="cf">for</span> album <span class="kw">in</span> df[<span class="st">"Album"</span>].unique():</span>
<span id="cb30-6"><a href=""></a>    conn.execute(<span class="ss">f"""CREATE (album:ALBUM </span><span class="ch">{{</span><span class="ss">name: "</span><span class="sc">{</span>album<span class="sc">}</span><span class="ss">"</span><span class="ch">}}</span><span class="ss">)"""</span>)</span>
<span id="cb30-7"><a href=""></a></span>
<span id="cb30-8"><a href=""></a><span class="cf">for</span> song, lyrics <span class="kw">in</span> df.select([<span class="st">"Song"</span>, <span class="st">"text"</span>]).unique().rows():</span>
<span id="cb30-9"><a href=""></a>    replaced_lyrics <span class="op">=</span> lyrics.replace(<span class="st">'"'</span>, <span class="st">"'"</span>)</span>
<span id="cb30-10"><a href=""></a>    conn.execute(</span>
<span id="cb30-11"><a href=""></a>        <span class="ss">f"""CREATE (song:SONG </span><span class="ch">{{</span><span class="ss">name: "</span><span class="sc">{</span>song<span class="sc">}</span><span class="ss">", lyrics: "</span><span class="sc">{</span>replaced_lyrics<span class="sc">}</span><span class="ss">"</span><span class="ch">}}</span><span class="ss">)"""</span></span>
<span id="cb30-12"><a href=""></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="graph-only-retrieval-4" class="slide level2">
<h2>Graph-only retrieval</h2>
<div id="c2d37055-54bd-44bb-ad06-8156f196954a" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:00:43.115165Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:00:43.114562Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:00:44.903437Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:00:44.901689Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:00:43.115111Z&quot;}" data-execution_count="28">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href=""></a><span class="co"># Insert edges</span></span>
<span id="cb31-2"><a href=""></a><span class="cf">for</span> song, album, lyrics <span class="kw">in</span> df.select([<span class="st">"Song"</span>, <span class="st">"Album"</span>, <span class="st">"text"</span>]).rows():</span>
<span id="cb31-3"><a href=""></a>    replaced_lyrics <span class="op">=</span> lyrics.replace(<span class="st">'"'</span>, <span class="st">"'"</span>)</span>
<span id="cb31-4"><a href=""></a>    conn.execute(</span>
<span id="cb31-5"><a href=""></a>        <span class="ss">f"""</span></span>
<span id="cb31-6"><a href=""></a><span class="ss">        MATCH (song:SONG), (album:ALBUM) </span></span>
<span id="cb31-7"><a href=""></a><span class="ss">        WHERE song.name = "</span><span class="sc">{</span>song<span class="sc">}</span><span class="ss">" AND song.lyrics = "</span><span class="sc">{</span>replaced_lyrics<span class="sc">}</span><span class="ss">" AND album.name = "</span><span class="sc">{</span>album<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb31-8"><a href=""></a><span class="ss">        CREATE (song)-[:IN_ALBUM]-&gt;(album)</span></span>
<span id="cb31-9"><a href=""></a><span class="ss">        """</span></span>
<span id="cb31-10"><a href=""></a>    )</span>
<span id="cb31-11"><a href=""></a></span>
<span id="cb31-12"><a href=""></a><span class="cf">for</span> album, artist <span class="kw">in</span> df.select([<span class="st">"Album"</span>, <span class="st">"Artist"</span>]).unique().rows():</span>
<span id="cb31-13"><a href=""></a>  conn.execute(</span>
<span id="cb31-14"><a href=""></a>    <span class="ss">f"""</span></span>
<span id="cb31-15"><a href=""></a><span class="ss">    MATCH (album:ALBUM), (artist:ARTIST) WHERE album.name = "</span><span class="sc">{</span>album<span class="sc">}</span><span class="ss">" AND artist.name = "</span><span class="sc">{</span>artist<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb31-16"><a href=""></a><span class="ss">    CREATE (album)-[:FROM_ARTIST]-&gt;(artist)</span></span>
<span id="cb31-17"><a href=""></a><span class="ss">    """</span></span>
<span id="cb31-18"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="graph-only-retrieval-5" class="slide level2">
<h2>Graph-only retrieval</h2>
<div id="7f86ca78-cd9a-441b-99ae-e03fa63de250" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:00:48.072092Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:00:48.071268Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:00:48.105110Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:00:48.103349Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:00:48.072012Z&quot;}" data-execution_count="29">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href=""></a>response <span class="op">=</span> conn.execute(</span>
<span id="cb32-2"><a href=""></a>    <span class="st">"""</span></span>
<span id="cb32-3"><a href=""></a><span class="st">    MATCH (a:ALBUM {name: 'The Black Album'})&lt;-[:IN_ALBUM]-(s:SONG) RETURN s.name</span></span>
<span id="cb32-4"><a href=""></a><span class="st">    """</span></span>
<span id="cb32-5"><a href=""></a>)</span>
<span id="cb32-6"><a href=""></a></span>
<span id="cb32-7"><a href=""></a>df_response <span class="op">=</span> response.get_as_pl()</span>
<span id="cb32-8"><a href=""></a></span>
<span id="cb32-9"><a href=""></a>df_response[<span class="st">"s.name"</span>].to_list()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>['Sad But True',
 'My Friend Of Misery',
 'Holier Than Thou',
 "Don't Tread On Me",
 'Through The Never',
 'The God That Failed',
 'Enter Sandman',
 'Nothing Else Matters',
 'Of Wolf And Man',
 'The Unforgiven',
 'Wherever I May Roam',
 'The Struggle Within']</code></pre>
</div>
</div>
</section>
<section id="text2cypher" class="slide level2">
<h2>text2cypher</h2>
<div id="7e2e25eb-1ae1-4e31-8ac3-c1a400e251fb" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:00:50.514091Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:00:50.513568Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:00:53.782222Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:00:53.780578Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:00:50.514042Z&quot;}" data-execution_count="31">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href=""></a><span class="im">import</span> weave</span>
<span id="cb34-2"><a href=""></a>weave.init(<span class="st">"pydata_paris"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Logged in as Weights &amp; Biases user: alonso-silva.
View Weave data at https://wandb.ai/alonso-silva/pydata_paris/weave</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>&lt;weave.trace.weave_client.WeaveClient at 0x7c543d72a4a0&gt;</code></pre>
</div>
</div>
</section>
<section id="text2cypher-1" class="slide level2">
<h2>text2cypher</h2>
<div id="31dac59f-ac63-4171-b4e9-30b5831d2fb3" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:00:56.250564Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:00:56.249610Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:00:56.437991Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:00:56.436685Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:00:56.250505Z&quot;}" data-execution_count="32">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href=""></a><span class="im">import</span> os</span>
<span id="cb37-2"><a href=""></a><span class="im">from</span> typing <span class="im">import</span> Optional</span>
<span id="cb37-3"><a href=""></a></span>
<span id="cb37-4"><a href=""></a><span class="im">from</span> langchain_community.chat_models <span class="im">import</span> ChatOpenAI</span>
<span id="cb37-5"><a href=""></a></span>
<span id="cb37-6"><a href=""></a><span class="kw">class</span> ChatOpenRouter(ChatOpenAI):</span>
<span id="cb37-7"><a href=""></a>    openai_api_base: <span class="bu">str</span></span>
<span id="cb37-8"><a href=""></a>    openai_api_key: <span class="bu">str</span></span>
<span id="cb37-9"><a href=""></a>    model_name: <span class="bu">str</span></span>
<span id="cb37-10"><a href=""></a></span>
<span id="cb37-11"><a href=""></a>    <span class="kw">def</span> <span class="fu">__init__</span>(</span>
<span id="cb37-12"><a href=""></a>        <span class="va">self</span>,</span>
<span id="cb37-13"><a href=""></a>        model_name: <span class="bu">str</span>,</span>
<span id="cb37-14"><a href=""></a>        openai_api_key: Optional[<span class="bu">str</span>] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb37-15"><a href=""></a>        openai_api_base: <span class="bu">str</span> <span class="op">=</span> <span class="st">"https://openrouter.ai/api/v1"</span>,</span>
<span id="cb37-16"><a href=""></a>        <span class="op">**</span>kwargs,</span>
<span id="cb37-17"><a href=""></a>    ):</span>
<span id="cb37-18"><a href=""></a>        openai_api_key <span class="op">=</span> os.getenv(<span class="st">"OPENROUTER_API_KEY"</span>)</span>
<span id="cb37-19"><a href=""></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(</span>
<span id="cb37-20"><a href=""></a>            openai_api_base<span class="op">=</span>openai_api_base,</span>
<span id="cb37-21"><a href=""></a>            openai_api_key<span class="op">=</span>openai_api_key,</span>
<span id="cb37-22"><a href=""></a>            model_name<span class="op">=</span>model_name,</span>
<span id="cb37-23"><a href=""></a>            <span class="op">**</span>kwargs,</span>
<span id="cb37-24"><a href=""></a>        )</span>
<span id="cb37-25"><a href=""></a></span>
<span id="cb37-26"><a href=""></a>llm_openrouter <span class="op">=</span> ChatOpenRouter(model_name<span class="op">=</span><span class="st">"meta-llama/llama-3.1-405b-instruct"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="graph-only-retrieval-6" class="slide level2">
<h2>Graph-only retrieval</h2>
<div id="b117560e-a7ca-4388-95af-59a231deb309" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:00:59.169283Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:00:59.168719Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:00:59.457909Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:00:59.457005Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:00:59.169231Z&quot;}" data-execution_count="34">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href=""></a><span class="im">from</span> langchain.chains <span class="im">import</span> KuzuQAChain</span>
<span id="cb38-2"><a href=""></a><span class="im">from</span> langchain_community.graphs <span class="im">import</span> KuzuGraph</span>
<span id="cb38-3"><a href=""></a></span>
<span id="cb38-4"><a href=""></a>graph <span class="op">=</span> KuzuGraph(db)</span>
<span id="cb38-5"><a href=""></a>chain <span class="op">=</span> KuzuQAChain.from_llm(</span>
<span id="cb38-6"><a href=""></a>    cypher_llm<span class="op">=</span>llm_openrouter,</span>
<span id="cb38-7"><a href=""></a>    qa_llm<span class="op">=</span>llm_openrouter,</span>
<span id="cb38-8"><a href=""></a>    graph<span class="op">=</span>graph,</span>
<span id="cb38-9"><a href=""></a>    verbose<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb38-10"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="graph-only-retrieval-7" class="slide level2">
<h2>Graph-only retrieval</h2>
<div id="5caa9ea2-632e-4221-80b2-53c1bad65f78" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:01:04.877623Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:01:04.877041Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:01:13.373360Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:01:13.372510Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:01:04.877570Z&quot;}" data-execution_count="35">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href=""></a>chain.invoke(<span class="st">"How many songs does the black album have?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

&gt; Entering new KuzuQAChain chain...
Generated Cypher:
MATCH (a:ALBUM {name: 'The Black Album'})-[:FROM_ARTIST]-(), (s:SONG)-[:IN_ALBUM]-&gt;(a) RETURN COUNT(s)
Full Context:
[{'COUNT(s._ID)': 12}]

&gt; Finished chain.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>{'query': 'How many songs does the black album have?',
 'result': 'The Black Album has 12 songs'}</code></pre>
</div>
</div>
</section>
<section id="graph-only-retrieval-8" class="slide level2">
<h2>Graph-only retrieval</h2>
<div id="08cbaacd-9503-4d2a-ba2e-05c1a4cab340" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:01:15.890222Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:01:15.889624Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:01:18.682294Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:01:18.681461Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:01:15.890167Z&quot;}" data-execution_count="36">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href=""></a>chain.invoke(<span class="st">"Which songs does the black album have?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

&gt; Entering new KuzuQAChain chain...
Generated Cypher:
MATCH (:ALBUM {name: 'The Black Album'})-[:IN_ALBUM]-&gt;(song:SONG) RETURN song.name
Full Context:
[]

&gt; Finished chain.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>{'query': 'Which songs does the black album have?',
 'result': "I don't know the answer."}</code></pre>
</div>
</div>
</section>
<section id="graph-only-retrieval-9" class="slide level2">
<h2>Graph-only retrieval</h2>
<div id="5a0b01ea-b49f-417f-a313-82f36e595160" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:01:24.463393Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:01:24.462797Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:01:24.472522Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:01:24.470398Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:01:24.463342Z&quot;}" data-execution_count="37">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href=""></a><span class="kw">def</span> generate_kuzu_prompt(user_query):</span>
<span id="cb45-2"><a href=""></a>    <span class="cf">return</span> <span class="st">"""Task: Generate Kùzu Cypher statement to query a graph database.</span></span>
<span id="cb45-3"><a href=""></a></span>
<span id="cb45-4"><a href=""></a><span class="st">Instructions:</span></span>
<span id="cb45-5"><a href=""></a><span class="st">Generate the Kùzu dialect of Cypher with the following rules in mind:</span></span>
<span id="cb45-6"><a href=""></a><span class="st">1. Do not omit the relationship pattern. Always use `()-[]-&gt;()` instead of `()-&gt;()`.</span></span>
<span id="cb45-7"><a href=""></a><span class="st">2. Do not include triple backticks ``` in your response. Return only Cypher.</span></span>
<span id="cb45-8"><a href=""></a><span class="st">3. Do not return any notes or comments in your response.</span></span>
<span id="cb45-9"><a href=""></a></span>
<span id="cb45-10"><a href=""></a></span>
<span id="cb45-11"><a href=""></a><span class="st">Use only the provided relationship types and properties in the schema.</span></span>
<span id="cb45-12"><a href=""></a><span class="st">Do not use any other relationship types or properties that are not provided.</span></span>
<span id="cb45-13"><a href=""></a><span class="st">Schema:</span><span class="ch">\n</span><span class="st">"""</span> <span class="op">+</span> graph.get_schema <span class="op">+</span> <span class="st">"""</span><span class="ch">\n</span><span class="st">Example:</span></span>
<span id="cb45-14"><a href=""></a><span class="st">The question is:</span><span class="ch">\n</span><span class="st">"Which songs does the load album have?"</span></span>
<span id="cb45-15"><a href=""></a><span class="st">MATCH (a:ALBUM {name: 'Load'})&lt;-[:IN_ALBUM]-(s:SONG) RETURN s.name</span></span>
<span id="cb45-16"><a href=""></a></span>
<span id="cb45-17"><a href=""></a><span class="st">Note: Do not include any explanations or apologies in your responses.</span></span>
<span id="cb45-18"><a href=""></a><span class="st">Do not respond to any questions that might ask anything else than for you to construct a Cypher statement.</span></span>
<span id="cb45-19"><a href=""></a><span class="st">Do not include any text except the generated Cypher statement.</span></span>
<span id="cb45-20"><a href=""></a></span>
<span id="cb45-21"><a href=""></a><span class="st">The question is:</span><span class="ch">\n</span><span class="st">"""</span> <span class="op">+</span> user_query</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="graph-only-retrieval-10" class="slide level2">
<h2>Graph-only retrieval</h2>
<div id="86d34379-83fe-49a5-8331-0e225f720eb5" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:01:25.992893Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:01:25.992360Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:01:26.001131Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:01:25.999450Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:01:25.992843Z&quot;}" data-execution_count="38">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href=""></a><span class="kw">def</span> generate_final_prompt(query,cypher_query,col_name,_values):</span>
<span id="cb46-2"><a href=""></a>    <span class="cf">return</span> <span class="ss">f"""You are an assistant that helps to form nice and human understandable answers.</span></span>
<span id="cb46-3"><a href=""></a><span class="ss">The information part contains the provided information that you must use to construct an answer.</span></span>
<span id="cb46-4"><a href=""></a><span class="ss">The provided information is authoritative, you must never doubt it or try to use your internal knowledge to correct it.</span></span>
<span id="cb46-5"><a href=""></a><span class="ss">Make the answer sound as a response to the question. Do not mention that you based the result on the given information.</span></span>
<span id="cb46-6"><a href=""></a><span class="ss">Here is an example:</span></span>
<span id="cb46-7"><a href=""></a></span>
<span id="cb46-8"><a href=""></a><span class="ss">Question: Which managers own Neo4j stocks?</span></span>
<span id="cb46-9"><a href=""></a><span class="ss">Context:[manager:CTL LLC, manager:JANE STREET GROUP LLC]</span></span>
<span id="cb46-10"><a href=""></a><span class="ss">Helpful Answer: CTL LLC, JANE STREET GROUP LLC owns Neo4j stocks.</span></span>
<span id="cb46-11"><a href=""></a></span>
<span id="cb46-12"><a href=""></a><span class="ss">Follow this example when generating answers.</span></span>
<span id="cb46-13"><a href=""></a><span class="ss">If the provided information is empty, say that you don't know the answer.</span></span>
<span id="cb46-14"><a href=""></a><span class="ss">Query:</span><span class="ch">\n</span><span class="sc">{</span>cypher_query<span class="sc">}</span></span>
<span id="cb46-15"><a href=""></a><span class="ss">Information:</span></span>
<span id="cb46-16"><a href=""></a><span class="ss">[</span><span class="sc">{</span>col_name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>_values<span class="sc">}</span><span class="ss">]</span></span>
<span id="cb46-17"><a href=""></a></span>
<span id="cb46-18"><a href=""></a><span class="ss">Question: </span><span class="sc">{</span>query<span class="sc">}</span></span>
<span id="cb46-19"><a href=""></a><span class="ss">Helpful Answer:</span></span>
<span id="cb46-20"><a href=""></a><span class="ss">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="graph-only-retrieval-11" class="slide level2">
<h2>Graph-only retrieval</h2>
<div id="5ed21db0-9078-4c38-ac77-b5c925d1165c" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:01:27.314968Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:01:27.314437Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:01:27.326518Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:01:27.324850Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:01:27.314919Z&quot;}" data-execution_count="39">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href=""></a><span class="kw">def</span> generate_kg_response(query):</span>
<span id="cb47-2"><a href=""></a>    prompt <span class="op">=</span> generate_kuzu_prompt(query)</span>
<span id="cb47-3"><a href=""></a>    cypher_query_response <span class="op">=</span> llm.create_chat_completion(</span>
<span id="cb47-4"><a href=""></a>        messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt}], </span>
<span id="cb47-5"><a href=""></a>        temperature<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb47-6"><a href=""></a>        seed<span class="op">=</span><span class="dv">42</span></span>
<span id="cb47-7"><a href=""></a>    )</span>
<span id="cb47-8"><a href=""></a>    cypher_query <span class="op">=</span> cypher_query_response[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">"message"</span>][<span class="st">"content"</span>]</span>
<span id="cb47-9"><a href=""></a>    response <span class="op">=</span> conn.execute(</span>
<span id="cb47-10"><a href=""></a>        <span class="ss">f"""</span></span>
<span id="cb47-11"><a href=""></a><span class="ss">        </span><span class="sc">{</span>cypher_query<span class="sc">}</span></span>
<span id="cb47-12"><a href=""></a><span class="ss">        """</span></span>
<span id="cb47-13"><a href=""></a>    )</span>
<span id="cb47-14"><a href=""></a>    df <span class="op">=</span> response.get_as_pl()</span>
<span id="cb47-15"><a href=""></a>    col_name <span class="op">=</span> df.columns[<span class="dv">0</span>]</span>
<span id="cb47-16"><a href=""></a>    _values <span class="op">=</span> df[col_name].to_list()</span>
<span id="cb47-17"><a href=""></a>    final_prompt <span class="op">=</span> generate_final_prompt(query,cypher_query,col_name,_values)</span>
<span id="cb47-18"><a href=""></a>    final_response <span class="op">=</span> llm.create_chat_completion(</span>
<span id="cb47-19"><a href=""></a>        messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: final_prompt}], </span>
<span id="cb47-20"><a href=""></a>        temperature<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb47-21"><a href=""></a>        seed<span class="op">=</span><span class="dv">42</span></span>
<span id="cb47-22"><a href=""></a>    )</span>
<span id="cb47-23"><a href=""></a>    <span class="cf">return</span> final_response[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">"message"</span>][<span class="st">"content"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="graph-only-retrieval-12" class="slide level2">
<h2>Graph-only retrieval</h2>
<div id="6015d02c-df89-424d-a2a5-954b6581ce3a" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:01:28.330990Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:01:28.330462Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:01:29.443336Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:01:29.442541Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:01:28.330941Z&quot;}" data-execution_count="40">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href=""></a>query <span class="op">=</span> <span class="st">"How many songs does the black album have?"</span></span>
<span id="cb48-2"><a href=""></a><span class="bu">print</span>(generate_kg_response(query))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The Black Album has 12 songs.</code></pre>
</div>
</div>
</section>
<section id="graph-only-retrieval-13" class="slide level2">
<h2>Graph-only retrieval</h2>
<div id="baf1adab-27da-4b81-afe5-69b3b5f17c42" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:01:31.464421Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:01:31.463507Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:01:33.925270Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:01:33.924000Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:01:31.464363Z&quot;}" data-execution_count="41">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href=""></a>query <span class="op">=</span> <span class="st">"Which songs does the black album have?"</span></span>
<span id="cb50-2"><a href=""></a><span class="bu">print</span>(generate_kg_response(query))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The Black Album has the following songs: Sad But True, My Friend Of Misery, Holier Than Thou, "Don't Tread On Me", Through The Never, The God That Failed, Enter Sandman, Nothing Else Matters, Of Wolf And Man, The Unforgiven, Wherever I May Roam, The Struggle Within.</code></pre>
</div>
</div>
</section>
<section id="graph-only-retrieval-14" class="slide level2">
<h2>Graph-only retrieval</h2>
<p><a href="https://alonsosilva-song-finder-graph.hf.space">https://alonsosilva-song-finder-graph.hf.space</a></p>
<div id="806a8b14-93ea-4a7c-81a0-c578706efd06" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:01:38.916866Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:01:38.916246Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:01:38.926165Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:01:38.924880Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:01:38.916812Z&quot;}" data-execution_count="42">
<div class="cell-output cell-output-display" data-execution_count="42">

        <iframe width="850" height="450" src="https://alonsosilva-song-finder-graph.hf.space" frameborder="0" allowfullscreen=""></iframe>
        
</div>
</div>
</section></section>
<section>
<section id="combining-graph-and-vector-retrieval" class="title-slide slide level1 center">
<h1>Combining graph and vector retrieval</h1>

</section>
<section id="classification" class="slide level2">
<h2>Classification</h2>
<div id="2783bab2-6bba-49d6-a58f-5eedbdb09b14" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:01:41.082851Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:01:41.082306Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:01:41.090236Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:01:41.088923Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:01:41.082799Z&quot;}" data-execution_count="43">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href=""></a><span class="kw">def</span> generate_hermes_prompt(user_prompt):</span>
<span id="cb52-2"><a href=""></a>    <span class="cf">return</span> (</span>
<span id="cb52-3"><a href=""></a>        <span class="st">"&lt;|im_start|&gt;system</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb52-4"><a href=""></a>        <span class="st">"You are a world class AI model classifier"</span></span>
<span id="cb52-5"><a href=""></a>        <span class="st">"&lt;|im_end|&gt;</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb52-6"><a href=""></a>        <span class="st">"&lt;|im_start|&gt;user</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb52-7"><a href=""></a>        <span class="op">+</span> user_prompt</span>
<span id="cb52-8"><a href=""></a>        <span class="op">+</span> <span class="st">"&lt;|im_end|&gt;"</span></span>
<span id="cb52-9"><a href=""></a>        <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">&lt;|im_start|&gt;assistant</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb52-10"><a href=""></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="classification-1" class="slide level2">
<h2>Classification</h2>
<div id="54f788a6-5f97-4d2a-b05a-16c5e5573832" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:01:42.770555Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:01:42.770002Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:01:44.866743Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:01:44.865937Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:01:42.770503Z&quot;}" data-execution_count="44">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href=""></a><span class="im">from</span> outlines <span class="im">import</span> generate, models</span>
<span id="cb53-2"><a href=""></a><span class="im">from</span> outlines.samplers <span class="im">import</span> greedy</span>
<span id="cb53-3"><a href=""></a></span>
<span id="cb53-4"><a href=""></a><span class="kw">def</span> get_classification(query):</span>
<span id="cb53-5"><a href=""></a>    model <span class="op">=</span> models.LlamaCpp(llm)</span>
<span id="cb53-6"><a href=""></a>    generator <span class="op">=</span> generate.choice(model, [<span class="st">"YES"</span>, <span class="st">"NO"</span>], sampler<span class="op">=</span>greedy())</span>
<span id="cb53-7"><a href=""></a>    prompt <span class="op">=</span> <span class="st">"Answer only YES or NO. Is the question '"</span> <span class="op">+</span> query <span class="op">+</span> <span class="st">"' related to the content of a song?"</span></span>
<span id="cb53-8"><a href=""></a>    prompt <span class="op">=</span> generate_hermes_prompt(prompt)</span>
<span id="cb53-9"><a href=""></a>    response <span class="op">=</span> generator(prompt, max_tokens<span class="op">=</span><span class="dv">1024</span>, temperature<span class="op">=</span><span class="dv">0</span>, seed<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb53-10"><a href=""></a>    <span class="cf">return</span> response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="classification-2" class="slide level2">
<h2>Classification</h2>
<div id="6ae946ef-10ce-48ae-a7a7-07635fd74674" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:01:44.871549Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:01:44.871355Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:01:45.785173Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:01:45.783889Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:01:44.871533Z&quot;}" data-execution_count="45">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href=""></a>queries <span class="op">=</span> [</span>
<span id="cb54-2"><a href=""></a>    <span class="st">"Which song is about a boy who is having nightmares?"</span>,</span>
<span id="cb54-3"><a href=""></a>    <span class="st">"Which song is about a guy who is so badly wounded in war so he no longer has any senses?"</span>,</span>
<span id="cb54-4"><a href=""></a>    <span class="st">"How many songs does the black album have?"</span>,</span>
<span id="cb54-5"><a href=""></a>    <span class="st">"Which songs does the black album have?"</span></span>
<span id="cb54-6"><a href=""></a>]</span>
<span id="cb54-7"><a href=""></a><span class="cf">for</span> query <span class="kw">in</span> queries:</span>
<span id="cb54-8"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"**</span><span class="sc">{</span>query<span class="sc">}</span><span class="ss">**"</span>)</span>
<span id="cb54-9"><a href=""></a>    <span class="bu">print</span>(get_classification(query))</span>
<span id="cb54-10"><a href=""></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>**Which song is about a boy who is having nightmares?**
YES

**Which song is about a guy who is so badly wounded in war so he no longer has any senses?**
YES

**How many songs does the black album have?**
NO

**Which songs does the black album have?**
NO
</code></pre>
</div>
</div>
</section>
<section id="combining-graph-and-vector-retrieval-1" class="slide level2">
<h2>Combining graph and vector retrieval</h2>
<div id="407c86bd-4fc4-49c4-9539-7e9532e41397" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:01:48.526857Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:01:48.526328Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:01:48.534686Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:01:48.533127Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:01:48.526807Z&quot;}" data-execution_count="48">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href=""></a><span class="kw">def</span> get_final_response(query):</span>
<span id="cb56-2"><a href=""></a>    query_class <span class="op">=</span> get_classification(query)</span>
<span id="cb56-3"><a href=""></a>    <span class="cf">if</span> query_class <span class="op">==</span> <span class="st">'YES'</span>:</span>
<span id="cb56-4"><a href=""></a>        response <span class="op">=</span> generate_response(query)</span>
<span id="cb56-5"><a href=""></a>    <span class="cf">else</span>:</span>
<span id="cb56-6"><a href=""></a>        response <span class="op">=</span> generate_kg_response(query)</span>
<span id="cb56-7"><a href=""></a>    <span class="cf">return</span> response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="combining-graph-and-vector-retrieval-2" class="slide level2">
<h2>Combining graph and vector retrieval</h2>
<div id="39163826-44da-4ded-9d83-169e96d2e91d" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:01:50.745377Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:01:50.744841Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:02:03.699761Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:02:03.698759Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:01:50.745328Z&quot;}" data-execution_count="49">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href=""></a>queries <span class="op">=</span> [</span>
<span id="cb57-2"><a href=""></a>    <span class="st">"Which song is about a boy who is having nightmares?"</span>,</span>
<span id="cb57-3"><a href=""></a>    <span class="st">"Which song is about a guy who is so badly wounded in war so he no longer has any senses"</span>,</span>
<span id="cb57-4"><a href=""></a>    <span class="st">"How many songs does the black album have?"</span>,</span>
<span id="cb57-5"><a href=""></a>    <span class="st">"Which songs does the black album have?"</span></span>
<span id="cb57-6"><a href=""></a>]</span>
<span id="cb57-7"><a href=""></a><span class="cf">for</span> query <span class="kw">in</span> queries:</span>
<span id="cb57-8"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"**</span><span class="sc">{</span>query<span class="sc">}</span><span class="ss">**"</span>)</span>
<span id="cb57-9"><a href=""></a>    <span class="bu">print</span>(get_final_response(query))</span>
<span id="cb57-10"><a href=""></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>**Which song is about a boy who is having nightmares?**
The song that is about a boy who is having nightmares is "The Black Album: Enter Sandman". The lyrics mention "Say your prayers little one", "tuck you in warm within", "keep you free from sin till the sandman he comes", "sleep with one eye open gripping your pillow tight", "dreams of war dreams of liars dreams of dragon's fire and of things that will bite", and "now I lay me down to sleep pray the lord my soul to keep". These lines indicate that the song is about a child having nightmares and fearing the dark.

**Which song is about a guy who is so badly wounded in war so he no longer has any senses**
Based on the context provided, the song "One" from the album "And Justice For All.." is about a guy who is so badly wounded in war that he no longer has any senses. The lyrics mention "I can't remember anything / Can't tell if this is true or dream / Deep down / inside I feel to scream / This terrible silence stops me / Now that the war is through with me / I'm waking up, I cannot see / That / there's not much left of me / Nothing is real but pain now".

**How many songs does the black album have?**
The Black Album has 12 songs.

**Which songs does the black album have?**
The Black Album has the following songs: Sad But True, My Friend Of Misery, Holier Than Thou, "Don't Tread On Me", Through The Never, The God That Failed, Enter Sandman, Nothing Else Matters, Of Wolf And Man, The Unforgiven, Wherever I May Roam, The Struggle Within.
</code></pre>
</div>
</div>
</section>
<section id="combining-graph-and-vectorial-retrieval" class="slide level2">
<h2>Combining graph and vectorial retrieval</h2>
<p><a href="https://alonsosilva-song-finder-graphrag.hf.space">https://alonsosilva-song-finder-graphrag.hf.space</a></p>
<div id="aa4f605b-92a1-4786-a799-d46356a41faa" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:02:08.128165Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:02:08.127498Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:02:08.139124Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:02:08.137331Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:02:08.128111Z&quot;}" data-execution_count="50">
<div class="cell-output cell-output-display" data-execution_count="50">

        <iframe width="850" height="450" src="https://alonsosilva-song-finder-graphrag.hf.space" frameborder="0" allowfullscreen=""></iframe>
        
</div>
</div>
</section></section>
<section>
<section id="knowledge-graph-construction" class="title-slide slide level1 center">
<h1>Knowledge graph construction</h1>

</section>
<section id="knowledge-graph-construction-1" class="slide level2">
<h2>Knowledge graph construction</h2>
<p><a href="https://alonsosilva-knowledgegraph.hf.space">https://alonsosilva-knowledgegraph.hf.space</a></p>
<div id="6177c61b-1160-4a6e-80f0-07fe02272b85" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:02:11.178088Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:02:11.177522Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:02:11.188731Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:02:11.186929Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:02:11.178037Z&quot;}" data-execution_count="51">
<div class="cell-output cell-output-display" data-execution_count="51">

        <iframe width="850" height="450" src="https://alonsosilva-knowledgegraph.hf.space" frameborder="0" allowfullscreen=""></iframe>
        
</div>
</div>
</section>
<section id="knowledge-graph-construction-2" class="slide level2">
<h2>Knowledge graph construction</h2>
<div id="790eb05c-7d91-42f3-b35c-8f6d1611a31b" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:02:12.457504Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:02:12.456972Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:02:12.467551Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:02:12.465655Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:02:12.457454Z&quot;}" data-execution_count="52">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href=""></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'/home/asilva/quarto/2024-PyData-Paris/kuzu-graph-rag/data/curie/curie.txt'</span>, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb59-2"><a href=""></a>    curie_text <span class="op">=</span> f.read()</span>
<span id="cb59-3"><a href=""></a><span class="bu">print</span>(curie_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>When Marie Curie came to the United States for the first time, in May 1921, she had already discovered the elements radium and polonium, coined the term “radio-active” and won the Nobel Prize—twice. But the Polish-born scientist, almost pathologically shy and accustomed to spending most of her time in her Paris laboratory, was stunned by the fanfare that greeted her. In 1898 she indeed identified one of the substances and named it polonium, after her homeland. Five months later, she identified a second element, which the world came to know as radium. Curie described the elements she studied as “radio-active.”

In 1894, she met Pierre Curie, a 35-year-old physicist at a French technical college who had been studying crystals and magnetism. More than a decade before, he and his brother Jacques had discovered piezoelectricity, the electric charge produced in solid materials under pressure. Pierre was taken by Marie’s uncommon intellect and drive, and he proposed to her. They were married in 1895 in a civil service attended by family and a few friends.

Both Curies shared the Nobel Prize in physics with Becquerel in 1903. It was the first Nobel to be awarded to a woman. In 1911, rumors spread that Curie was having an affair with the prominent physicist Paul Langevin, a man five years her junior who had been Pierre’s student and had worked closely with Albert Einstein. The front-page coverage of the scandal threatened to overshadow another news story later that year: her second Nobel Prize.

This one, in chemistry, was for the discovery of polonium and radium. In her acceptance speech in Stockholm, she paid tribute to her husband but also made clear that her work was independent from his, spelling out their separate contributions and describing the discoveries she had made after his death.
</code></pre>
</div>
</div>
</section>
<section id="knowledge-graph-construction-3" class="slide level2">
<h2>Knowledge graph construction</h2>
<div id="13bd04c3-30b5-473d-add4-f247f741cbae" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:02:16.248617Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:02:16.248054Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:02:16.300064Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:02:16.299164Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:02:16.248565Z&quot;}" data-execution_count="53">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href=""></a><span class="im">from</span> enum <span class="im">import</span> Enum</span>
<span id="cb61-2"><a href=""></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, Field</span>
<span id="cb61-3"><a href=""></a></span>
<span id="cb61-4"><a href=""></a><span class="kw">class</span> Node_Type(<span class="bu">str</span>, Enum):</span>
<span id="cb61-5"><a href=""></a>    <span class="co">"""The type of node of the knowledge graph"""</span></span>
<span id="cb61-6"><a href=""></a>    PERSON <span class="op">=</span> <span class="st">"PERSON"</span></span>
<span id="cb61-7"><a href=""></a>    NOBEL_PRIZE_FIELD <span class="op">=</span> <span class="st">"NOBEL_PRIZE_FIELD"</span></span>
<span id="cb61-8"><a href=""></a>    LOCATION <span class="op">=</span> <span class="st">"LOCATION"</span></span>
<span id="cb61-9"><a href=""></a>    DISCOVERY <span class="op">=</span> <span class="st">"DISCOVERY"</span></span>
<span id="cb61-10"><a href=""></a></span>
<span id="cb61-11"><a href=""></a><span class="kw">class</span> Node(BaseModel):</span>
<span id="cb61-12"><a href=""></a>    <span class="co">"""Node of the Knowledge Graph"""</span></span>
<span id="cb61-13"><a href=""></a></span>
<span id="cb61-14"><a href=""></a>    <span class="bu">id</span>: <span class="bu">int</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Unique identifier of the node"</span>)</span>
<span id="cb61-15"><a href=""></a>    label: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Label of the node"</span>)</span>
<span id="cb61-16"><a href=""></a>    node_type : Node_Type</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="knowledge-graph-construction-4" class="slide level2">
<h2>Knowledge graph construction</h2>
<div id="6d8917e4-5e66-40a7-b6ca-1f0d9966de69" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:02:18.097399Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:02:18.096805Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:02:18.113956Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:02:18.112688Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:02:18.097344Z&quot;}" data-execution_count="54">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href=""></a><span class="kw">class</span> Edge_Type(<span class="bu">str</span>, Enum):</span>
<span id="cb62-2"><a href=""></a>    <span class="co">"""The type of edge of the knowledge graph"""</span></span>
<span id="cb62-3"><a href=""></a>    IS_MARRIED_TO <span class="op">=</span> <span class="st">"IS_MARRIED_TO"</span></span>
<span id="cb62-4"><a href=""></a>    WORKED_WITH <span class="op">=</span> <span class="st">"WORKED_WITH"</span></span>
<span id="cb62-5"><a href=""></a>    WON <span class="op">=</span> <span class="st">"WON"</span></span>
<span id="cb62-6"><a href=""></a>    DISCOVERED <span class="op">=</span> <span class="st">"DISCOVERED"</span></span>
<span id="cb62-7"><a href=""></a></span>
<span id="cb62-8"><a href=""></a><span class="kw">class</span> Edge(BaseModel):</span>
<span id="cb62-9"><a href=""></a>    <span class="co">"""Edge of the Knowledge Graph"""</span></span>
<span id="cb62-10"><a href=""></a></span>
<span id="cb62-11"><a href=""></a>    source: <span class="bu">int</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Unique source of the edge"</span>)</span>
<span id="cb62-12"><a href=""></a>    target: <span class="bu">int</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Unique target of the edge"</span>)</span>
<span id="cb62-13"><a href=""></a>    label: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Label of the edge"</span>)</span>
<span id="cb62-14"><a href=""></a>    edge_type: Edge_Type</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="knowledge-graph-construction-5" class="slide level2">
<h2>Knowledge graph construction</h2>
<div id="3a5260dd-b10f-4d70-b513-1f95c880a771" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:02:20.066722Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:02:20.066160Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:02:20.079152Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:02:20.077436Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:02:20.066668Z&quot;}" data-execution_count="55">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href=""></a><span class="im">from</span> typing <span class="im">import</span> List</span>
<span id="cb63-2"><a href=""></a></span>
<span id="cb63-3"><a href=""></a><span class="kw">class</span> KnowledgeGraph(BaseModel):</span>
<span id="cb63-4"><a href=""></a>    <span class="co">"""Generated Knowledge Graph"""</span></span>
<span id="cb63-5"><a href=""></a></span>
<span id="cb63-6"><a href=""></a>    nodes: List[Node] <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"List of nodes of the knowledge graph"</span>)</span>
<span id="cb63-7"><a href=""></a>    edges: List[Edge] <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"List of edges of the knowledge graph"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="knowledge-graph-construction-6" class="slide level2">
<h2>Knowledge graph construction</h2>
<div id="596f3978-01d3-4c33-84bf-19393324a4b2" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:02:21.042815Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:02:21.042289Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:02:21.056858Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:02:21.055112Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:02:21.042764Z&quot;}" data-execution_count="56">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href=""></a><span class="im">from</span> outlines.integrations.utils <span class="im">import</span> convert_json_schema_to_str</span>
<span id="cb64-2"><a href=""></a><span class="im">from</span> outlines.fsm.json_schema <span class="im">import</span> build_regex_from_schema</span>
<span id="cb64-3"><a href=""></a></span>
<span id="cb64-4"><a href=""></a>json_schema <span class="op">=</span> KnowledgeGraph.model_json_schema()</span>
<span id="cb64-5"><a href=""></a>schema_str <span class="op">=</span> convert_json_schema_to_str(json_schema<span class="op">=</span>json_schema)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="knowledge-graph-construction-7" class="slide level2">
<h2>Knowledge graph construction</h2>
<div id="3b6bd486-f49a-4f4d-a270-71f304b799e0" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:02:22.633360Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:02:22.632828Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:02:22.641837Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:02:22.640020Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:02:22.633309Z&quot;}" data-execution_count="57">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href=""></a><span class="kw">def</span> generate_hermes_prompt(user_prompt):</span>
<span id="cb65-2"><a href=""></a>    <span class="cf">return</span> (</span>
<span id="cb65-3"><a href=""></a>        <span class="st">"&lt;|im_start|&gt;system</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb65-4"><a href=""></a>        <span class="st">"You are a world class AI model who extract in JSON with correct Pydantic schema. "</span></span>
<span id="cb65-5"><a href=""></a>        <span class="ss">f"Here's the json schema you must adhere to:</span><span class="ch">\n</span><span class="ss">&lt;schema&gt;</span><span class="ch">\n</span><span class="sc">{</span>schema_str<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/schema&gt;&lt;|im_end|&gt;</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb65-6"><a href=""></a>        <span class="st">"&lt;|im_start|&gt;user</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb65-7"><a href=""></a>        <span class="op">+</span> user_prompt</span>
<span id="cb65-8"><a href=""></a>        <span class="op">+</span> <span class="st">"&lt;|im_end|&gt;"</span></span>
<span id="cb65-9"><a href=""></a>        <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">&lt;|im_start|&gt;assistant</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb65-10"><a href=""></a>        <span class="st">"&lt;schema&gt;"</span></span>
<span id="cb65-11"><a href=""></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="knowledge-graph-construction-8" class="slide level2">
<h2>Knowledge graph construction</h2>
<div id="a531416b-422e-41f1-bfd5-e2976bce6849" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:02:24.956625Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:02:24.956075Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:02:33.487677Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:02:33.486915Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:02:24.956574Z&quot;}" data-execution_count="58">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href=""></a><span class="im">from</span> outlines <span class="im">import</span> generate, models</span>
<span id="cb66-2"><a href=""></a>model <span class="op">=</span> models.LlamaCpp(llm)</span>
<span id="cb66-3"><a href=""></a>generator <span class="op">=</span> generate.json(model, KnowledgeGraph)</span>
<span id="cb66-4"><a href=""></a>prompt <span class="op">=</span> generate_hermes_prompt(curie_text)</span>
<span id="cb66-5"><a href=""></a>response <span class="op">=</span> generator(prompt, max_tokens<span class="op">=</span><span class="dv">1024</span>, temperature<span class="op">=</span><span class="dv">0</span>, seed<span class="op">=</span><span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="dc1be9ec-db03-4af3-8257-316eeb14eeb1" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:02:34.149741Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:02:34.149155Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:02:34.158924Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:02:34.157643Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:02:34.149688Z&quot;}" data-execution_count="59">
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>[Node(id=1, label='Marie Curie', node_type=&lt;Node_Type.PERSON: 'PERSON'&gt;),
 Node(id=2, label='Pierre Curie', node_type=&lt;Node_Type.PERSON: 'PERSON'&gt;),
 Node(id=3, label='Polonium', node_type=&lt;Node_Type.DISCOVERY: 'DISCOVERY'&gt;),
 Node(id=4, label='Radium', node_type=&lt;Node_Type.DISCOVERY: 'DISCOVERY'&gt;),
 Node(id=5, label='Nobel Prize', node_type=&lt;Node_Type.NOBEL_PRIZE_FIELD: 'NOBEL_PRIZE_FIELD'&gt;)]</code></pre>
</div>
</div>
<div id="f78dc9eb-0404-4c57-91c3-8eb85b9ed4d1" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:02:35.998577Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:02:35.998014Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:02:36.008516Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:02:36.006781Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:02:35.998524Z&quot;}" data-execution_count="60">
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>[Edge(source=1, target=3, label='DISCOVERED', edge_type=&lt;Edge_Type.DISCOVERED: 'DISCOVERED'&gt;),
 Edge(source=1, target=4, label='DISCOVERED', edge_type=&lt;Edge_Type.DISCOVERED: 'DISCOVERED'&gt;),
 Edge(source=1, target=5, label='WON', edge_type=&lt;Edge_Type.WON: 'WON'&gt;),
 Edge(source=1, target=2, label='IS_MARRIED_TO', edge_type=&lt;Edge_Type.IS_MARRIED_TO: 'IS_MARRIED_TO'&gt;),
 Edge(source=2, target=5, label='WON', edge_type=&lt;Edge_Type.WON: 'WON'&gt;)]</code></pre>
</div>
</div>
</section>
<section id="knowledge-graph-construction-9" class="slide level2">
<h2>Knowledge graph construction</h2>
<div id="e517cf8a-2fa3-40e2-9698-19d2bf06590d" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-09-25T07:03:05.633951Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-25T07:03:05.633388Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-25T07:03:05.744451Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-25T07:03:05.743121Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-25T07:03:05.633897Z&quot;}" data-execution_count="61">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href=""></a><span class="im">from</span> graphviz <span class="im">import</span> Digraph</span>
<span id="cb69-2"><a href=""></a></span>
<span id="cb69-3"><a href=""></a>dot <span class="op">=</span> Digraph()</span>
<span id="cb69-4"><a href=""></a><span class="cf">for</span> node <span class="kw">in</span> response.nodes:</span>
<span id="cb69-5"><a href=""></a>    dot.node(<span class="bu">str</span>(node.<span class="bu">id</span>), node.label, shape<span class="op">=</span><span class="st">'circle'</span>, width<span class="op">=</span><span class="st">'1'</span>, height<span class="op">=</span><span class="st">'1'</span>)</span>
<span id="cb69-6"><a href=""></a><span class="cf">for</span> edge <span class="kw">in</span> response.edges:</span>
<span id="cb69-7"><a href=""></a>    dot.edge(<span class="bu">str</span>(edge.source), <span class="bu">str</span>(edge.target), label<span class="op">=</span>edge.label.upper())</span>
<span id="cb69-8"><a href=""></a></span>
<span id="cb69-9"><a href=""></a>dot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="PyData-Paris_files/figure-revealjs/cell-62-output-1.svg" class="r-stretch"></section></section>
<section>
<section id="conclusions" class="title-slide slide level1 center">
<h1>Conclusions</h1>

</section>
<section id="conclusions-1" class="slide level2">
<h2>Conclusions</h2>
<ul>
<li>The goal is to provide better context to the LLM prior to generating its response</li>
<li>Combining graph + vector retrieval help us to achieve this goal better than vector-only retrieval or graph-only retrieval</li>
<li>Knowledge graph construction with structured outputs allows us to constrain the node types and edge types explicitly</li>
</ul>
</section>
<section id="references" class="slide level2">
<h2>References</h2>
<ul>
<li><a href="https://neo4j.com/developer-blog/enhance-rag-knowledge-graph/">Enhancing the Accuracy of RAG Applications With Knowledge Graphs</a> by Tomaž Bratanič</li>
<li><a href="https://neo4j.com/developer-blog/genai-powered-song-finder/">A GenAI-Powered Song Finder in Four Lines of Code</a> by Christoffer Bergman</li>
<li><a href="https://github.com/kuzudb/graph-rag">Graph RAG strategies using Kùzu</a> by Prashanth Rao</li>
<li><a href="https://github.com/lancedb/lancedb">LanceDB</a> (vector DB) + <a href="https://github.com/kuzudb/kuzu">Kùzu</a> (graph DB) + <a href="https://github.com/abetlen/llama-cpp-python">Llama.cpp</a> (inference) + <a href="https://dottxt-ai.github.io/outlines/">Outlines</a> (structured outputs) + <a href="https://github.com/langchain-ai/langchain">LangChain</a> (framework) + <a href="https://github.com/widgetti/solara">Solara</a> (visualization)</li>
</ul>

</section><div class="quarto-auto-generated-content">
<div class="footer footer-default">

</div>
</div></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="PyData-Paris_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="PyData-Paris_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="PyData-Paris_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="PyData-Paris_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="PyData-Paris_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="PyData-Paris_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="PyData-Paris_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="PyData-Paris_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="PyData-Paris_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="PyData-Paris_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>